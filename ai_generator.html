<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å•†å“æ–‡æ¡ˆç”Ÿæˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        .result-box {
            display: none;
        }

        .loading-spinner {
            display: none;
        }

        body {
            display: none;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg sticky-top custom-navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand">ğŸ›’ å•†åº—å¾Œå°ç®¡ç†ç³»çµ±</a>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" id="nav-order" href="order_page.html">ğŸ“‹ è¨‚å–®é é¢</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="nav-ai" href="ai_generator.html">âœ¨ AI è¼”åŠ©ä¸Šæ¶</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="nav-upload" href="product_upload.html">ğŸ“¦ å•†å“ä¸Šæ¶</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="nav-list" href="product_list.html">ğŸ” å•†å“æŸ¥è©¢/ä¿®æ”¹</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div class="container-fluid mt-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="text-white fw-bold">âœ¨ AI å•†å“éˆæ„Ÿç”ŸæˆåŠ©æ‰‹</h2>
            </div>
        </div>
    </div>



    <div class="container-fluid px-4">
        <div class="row justify-content-center">
            <div class="card ai-card">
                <div class="card-body">
                    <p class="text-muted" style="color: #cbd5e0 !important;">è«‹è¼¸å…¥å•†å“çš„åŸºæœ¬è³‡è¨Šï¼ŒAI å°‡ç‚ºæ‚¨è‡ªå‹•ç”Ÿæˆæ¨™é¡Œã€æè¿°èˆ‡é—œéµå­—ã€‚</p>

                    <div class="form-group">
                        <label class="font-weight-bold">å•†å“åç¨±</label>
                        <input type="text" id="aiName" class="form-control">
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="font-weight-bold">é è¨ˆå”®åƒ¹</label>
                                <input type="number" id="aiPrice" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="font-weight-bold">ç”¢å“é—œéµå­—</label>
                                <input type="text" id="aiKeys" class="form-control" placeholder="ä½¿ç”¨ã€åˆ†éš”">
                            </div>
                        </div>
                    </div>

                    <div class="d-grid col-md-6 mx-auto mt-4">
                        <button id="btn-gen" class="btn btn-info fw-bold shadow-sm">
                            <span class="loading-spinner spinner-border spinner-border-sm me-2"></span><span
                                class="btn-text">é–‹å§‹ AI ç”Ÿæˆå…§å®¹</span>
                        </button>
                    </div>

                    <div id="resultArea" class="result-box mt-5">
                        <h4 class="text-info border-bottom pb-3 mb-4">âœ¨ AI å»ºè­°æ–¹æ¡ˆ</h4>

                        <div class="mb-4">
                            <div class="badge bg-secondary mb-2">å»ºè­°æ¨™é¡Œ</div>
                            <div id="resTitle" class="fw-bold text-white"></div>
                        </div>

                        <div class="mb-4">
                            <div class="badge bg-secondary mb-2">å»ºè­°å”®åƒ¹</div>
                            <div id="resPrice" class="text-danger fw-bold"></div>
                        </div>

                        <div class="mb-4">
                            <div class="badge bg-secondary mb-2">æ–‡æ¡ˆå…§å®¹</div>
                            <div id="resDesc" class="text-light" style="white-space: pre-line;"></div>
                        </div>

                        <div class="button-container">
                            <button id="btn-confirm" class="btn btn-success shadow-sm">
                                âœ… å…§å®¹å®Œç¾ï¼Œå‰å¾€ä¸Šæ¶é é¢
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ä½ çš„ Firebase Config (è«‹å‹™å¿…å¡«å¯«æ­£ç¢º)
        const firebaseConfig = {
            apiKey: "AIzaSyAEKrtUed8tzL1s072W9eWrTfT1RXfkOKA",
            authDomain: "test01-dd13e.firebaseapp.com",
            projectId: "test01-dd13e",
            storageBucket: "test01-dd13e.firebasestorage.app",
            messagingSenderId: "262581605790",
            appId: "1:262581605790:web:456fcca5091299e285728f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const adminEmails = ["moonlightcafe.com@gmail.com"]; // ä½ çš„å•†å®¶ç®¡ç†å¸³è™Ÿ

        // åŸ·è¡Œèº«åˆ†æª¢æŸ¥
        onAuthStateChanged(auth, (user) => {
            if (user && adminEmails.includes(user.email)) {
                // âœ… æƒ…æ³ Aï¼šå·²ç™»å…¥ä¸”æ˜¯ç®¡ç†å“¡
                console.log("é©—è­‰é€šé");
                document.body.style.display = "block"; // åªæœ‰é€™æ™‚æ‰è§£é™¤éš±è—ï¼Œé¡¯ç¤ºä»‹é¢
            } else {
                // âŒ æƒ…æ³ Bï¼šæœªç™»å…¥æˆ–èº«åˆ†ä¸ç¬¦
                if (user) {
                    alert("æ­¤å¸³è™Ÿç„¡ç®¡ç†æ¬Šé™");
                }
                // ç›´æ¥å¼·åˆ¶è·³è½‰å›ç™»å…¥é¦–é 
                window.location.href = "index.html";
            }
        });



        // AI ç”ŸæˆæŒ‰éˆ•é»æ“Šäº‹ä»¶
        document.getElementById('btn-gen').addEventListener('click', async () => {
            const name = document.getElementById('aiName').value;
            const price = document.getElementById('aiPrice').value;
            const keys = document.getElementById('aiKeys').value;

            if (!name) return alert("è«‹è¼¸å…¥å•†å“åç¨±");

            // UI ç‹€æ…‹åˆ‡æ›ï¼šé¡¯ç¤ºè¼‰å…¥ä¸­
            $('.loading-spinner').show();
            $('.btn-text').text('AI æ€è€ƒä¸­...');
            $('#btn-gen').prop('disabled', true);
            $('#resultArea').hide();

            try {
                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": "Bearer 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",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [
                            {
                                role: "system",
                                content: `ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„å°ç£è³ªæ„Ÿå’–å•¡å»³å“ç‰Œè¡ŒéŠ·å°ˆå®¶ã€‚è«‹æ ¹æ“šæä¾›çš„è³‡è¨Šç”Ÿæˆä¸€å€‹ JSON ç‰©ä»¶ã€‚ JSON æ ¼å¼å¿…é ˆåš´æ ¼éµå®ˆï¼š{ "title": "...", "detail": "...", "price": æ•¸å­— }ã€‚

                                é—œæ–¼ "detail" æ¬„ä½ï¼Œè«‹å‹™å¿…æŒ‰ç…§ä»¥ä¸‹çµæ§‹æ’°å¯«ï¼Œä¸¦ç¢ºä¿å…§å®¹è¶…é 250 å­—ï¼Œå£å»æº«æŸ”ã€æ–‡é’ä¸”å…·å„€å¼æ„Ÿï¼š
                                [é–‹é ­æ„Ÿæ€§æ–‡æ¡ˆ]ï¼šè«‹æ ¹æ“štitleçš„å•†å“åç¨±å¯«ä¸€æ®µæ„Ÿæ€§è©©å¥ä½œç‚ºé–‹å ´ï¼ˆä¸é ˆæ¨™é¡Œï¼‰ï¼Œå­—æ•¸ä»‹æ–¼30åˆ°40å­—ï¼Œä¸”æ•´æ®µæ–‡å­—å¿…é ˆä½¿ç”¨ã€Œç²—æ–œé«”ã€æ ¼å¼ï¼ˆä¾‹å¦‚ï¼š<b><i>é€™æ˜¯ä¸€æ®µåˆå¾Œçš„æº«æŸ”èªéŒ„...</i></b>ï¼‰ã€‚

                                ã€é¢¨å‘³å±¤æ¬¡ã€‘ï¼šç”Ÿå‹•æè¿°é¢¨å‘³çš„å‰èª¿ã€ä¸­èª¿èˆ‡é¤˜éŸ»ï¼ˆå¦‚ï¼šå¾®é…¸å¾Œçš„ç”˜ç”œã€ç¶¿å¯†ç´°ç·»çš„å£æ„Ÿï¼‰ã€‚

                                ã€è·äººå …æŒã€‘ï¼šä½¿ç”¨æ¢åˆ—é»ï¼ˆâ€¢ï¼‰æè¿°é£Ÿæä¾†æºï¼ˆå¦‚åœ¨åœ°å°è¾²ã€è·äººçƒ˜ç„™ã€å¤©ç„¶ç„¡æ·»åŠ ï¼‰èˆ‡æ‰‹ä½œå·¥è—çš„å …æŒã€‚

                                ã€å“åšå»ºè­°ã€‘ï¼šæä¾›æœ€ä½³äº«ç”¨æ–¹å¼ï¼ˆå¦‚ï¼šå»ºè­°å…ˆå•œå¸ä¸€å£åŸå‘³ã€å»ºè­°æ­é…çš„ç”œé»æˆ–é£²å“ï¼‰ã€‚

                                ã€ç”¢å“è³‡è¨Šã€‘ï¼šé£²å“å®¹é‡ï¼ˆçš†ç‚º500mlï¼‰æˆ–ç”œé»ä»½é‡ï¼ˆè›‹ç³•é¡çš†ç‚ºåˆ‡ç‰‡ï¼‰ã€é£Ÿæéæ•åŸæé†’ç­‰ï¼Œä¸¦ç‰¹åˆ¥æ¨™è¨»åœ–ç‰‡åƒ…ä¾›åƒè€ƒã€‚

                                è«‹ä½¿ç”¨å°ç£å’–å•¡å»³ã€æ–‡è—ç¤¾ç¾¤é¢¨æ ¼å¸¸ç”¨è©å½™ï¼ˆå¦‚ã€Œæ—¥å¸¸ã€ã€ã€Œæº«æ½¤ã€ã€ã€Œé¤˜éŸ»ã€ã€ã€Œæ‰‹ä½œã€ã€ã€Œéœè¬ã€ï¼‰ï¼Œä¸¦åœ¨ detail ä¸­é©ç•¶æ›è¡Œä»¥ç¢ºä¿è‰¯å¥½çš„é–±è®€é«”é©—ã€‚`
                            },
                            { role: "user", content: `å“å: ${name}, å”®åƒ¹: ${price}` }
                        ],
                        response_format: { "type": "json_object" }
                    })
                });

                const data = await response.json();
                const result = JSON.parse(data.choices[0].message.content);

                // é¡¯ç¤ºçµæœ
                $('#resTitle').text(result.title);
                $('#resPrice').text(`NT$ ${result.price}`);
                $('#resDesc').html(result.detail);
                $('#resultArea').fadeIn();

                // å°‡è³‡æ–™æš«å­˜åˆ° localStorage (é€™æ˜¯è·¨é é¢å‚³éçš„é—œéµ)
                localStorage.setItem('pending_product', JSON.stringify(result));

            } catch (err) {
                alert("AI ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¢ºèª API Key æˆ–ç¶²è·¯ç‹€æ³");
                console.error(err);
            } finally {
                $('.loading-spinner').hide();
                $('.btn-text').text('é–‹å§‹ AI ç”Ÿæˆå…§å®¹');
                $('#btn-gen').prop('disabled', false);
            }
        });

        // è·³è½‰æŒ‰éˆ•
        document.getElementById('btn-confirm').addEventListener('click', () => {
            // è·³è½‰åˆ°ä¸Šæ¶é é¢
            window.location.href = "product_upload.html";
        });
    </script>

</body>

</html>