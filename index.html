<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonlight CafÃ© å¾Œå°ç®¡ç†ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg sticky-top custom-navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand">ğŸ›’ å•†åº—å¾Œå°ç®¡ç†ç³»çµ±</a>
        </div>
    </nav>

    <div class="container mt-5">
        <div id="login-section" class="text-center py-5">
            <h2 class="mb-4"><strong>è«‹ä½¿ç”¨å·²èªè­‰å¸³è™Ÿç™»å…¥</strong></h2>
            <h5 class="text-muted mb-4"><strong>æœ¬ç³»çµ±åƒ…ä¾›æˆæ¬Šç®¡ç†å“¡ä½¿ç”¨</strong></h5>
            <button id="login-btn" style="
                background-color: rgb(237, 238, 242); 
                border: 3px solid #1e3a72; 
                border-radius: 8px;
                align-items: center;
                justify-content: center;
                padding: 10px 60px;
            ">
                <img src="./images/google.webp" alt="Google ç™»å…¥" style="width: 150px;">
            </button>
        </div>

        <div id="admin-content" style="display: none;">
            <div class="alert alert-success">
                æ­¡è¿å›ä¾†ï¼Œ<span id="admin-name" class="fw-bold"></span>ï¼æ‚¨å·²æˆåŠŸé€²å…¥å•†å®¶å¾Œå°ç³»çµ±ã€‚
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">ç®¡ç†é¸å–®</h5>
                            <p class="card-text">æ‚¨ç¾åœ¨å¯ä»¥é€²è¡Œå•†å“ç®¡ç†èˆ‡è¨‚å–®ç›£æ§ã€‚</p>
                            <a href="product-management.html" class="btn btn-dark">é€²å…¥å•†å“ç®¡ç†</a>
                            <a href="order-monitor.html" class="btn btn-dark">æŸ¥çœ‹å³æ™‚è¨‚å–®</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // å¼•å…¥ Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

        import {
            getAuth,
            signInWithPopup,
            GoogleAuthProvider,
            onAuthStateChanged,
            signOut,
            setPersistence,
            browserSessionPersistence
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Firebase å°ˆæ¡ˆé…ç½®
        const firebaseConfig = {
            apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
            authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
            projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
            storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
            messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
            appId: import.meta.env.VITE_FIREBASE_APP_ID
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // è¨­å®šç®¡ç†å“¡ç™½åå–®
        const adminEmails = ["moonlightcafe.com@gmail.com"];

        const loginBtn = document.getElementById('login-btn');
        const loginSection = document.getElementById('login-section');
        const adminContent = document.getElementById('admin-content');
        const adminNameSpan = document.getElementById('admin-name');


        onAuthStateChanged(auth, (user) => {
            if (user) {
                // æª¢æŸ¥æ˜¯å¦åœ¨ç®¡ç†å“¡ç™½åå–®å…§
                if (adminEmails.includes(user.email)) {
                    console.log("é©—è­‰æˆåŠŸï¼Œæº–å‚™è·³è½‰...");
                    // æ›´æ–° UI
                    adminNameSpan.textContent = user.displayName;
                    window.location.href = "order_page.html";

                } else {
                    // éç®¡ç†å“¡
                    alert("æ¬Šé™ä¸è¶³ï¼šæ‚¨çš„å¸³è™Ÿä¸¦éæˆæ¬Šå•†å®¶ã€‚");
                    signOut(auth);
                }
            } else {
                // æœªç™»å…¥ç‹€æ…‹
                loginSection.style.display = 'block';
                adminContent.style.display = 'none';
            }
        });

        // ç™»å…¥äº‹ä»¶
        loginBtn.onclick = async () => {
            try {
                await setPersistence(auth, browserSessionPersistence);
                await signInWithPopup(auth, provider);
                console.log("ç™»å…¥æˆåŠŸ");
            } catch (error) {
                console.error("ç™»å…¥éŒ¯èª¤ä»£ç¢¼:", error.code);
                console.error("éŒ¯èª¤è¨Šæ¯:", error.message);
                alert("ç™»å…¥å¤±æ•—");
            }
        };
    </script>
</body>

</html>