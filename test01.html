<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>商品前端展示頁面 - 範例</title>
    <style>
        .product-item {
            border: 1px solid #ccc;
            padding: 15px;
            margin: 10px;
            display: inline-block;
            vertical-align: top;
            width: 250px;
        }
        .product-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .price { color: red; font-weight: bold; }
        .tag { background: #eee; padding: 2px 5px; font-size: 12px; margin-right: 5px; }
    </style>
</head>
<body>

    <h1>商品展示清單</h1>
    <div id="displayContainer">載入中...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // 1. Firebase 配置資訊 (與後端管理系統相同)
        const firebaseConfig = {
            apiKey: "AIzaSyAEKrtUed8tzL1s072W9eWrTfT1RXfkOKA",
            authDomain: "test01-dd13e.firebaseapp.com",
            projectId: "test01-dd13e",
            storageBucket: "test01-dd13e.firebasestorage.app",
            messagingSenderId: "262581605790",
            appId: "1:262581605790:web:456fcca5091299e285728f"
        };

        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function fetchProducts() {
            const container = document.getElementById('displayContainer');
            
            try {
                // 指向你的 "products" 集合，並依照時間排序
                const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);

                container.innerHTML = ''; // 清空載入中文字

                querySnapshot.forEach((doc) => {
                    const item = doc.data(); // 這就是資料庫裡的一筆商品資料

                    /* --- 資料庫欄位對照註解 ---
                       item.name        : 商品名稱 (String)
                       item.price       : 價格 (Number/String)
                       item.description : 詳細描述 (String)
                       item.imageUrls   : 圖片陣列 (Array)，通常取 [0] 當主圖
                       item.keywords    : 標籤陣列 (Array)
                       item.createdAt   : 建立時間 (Firebase Timestamp)
                    */

                    // 準備圖片：如果有圖片就抓第一張，沒有就用預設圖
                    const imgUrl = (item.imageUrls && item.imageUrls.length > 0) 
                                    ? item.imageUrls[0] 
                                    : 'https://via.placeholder.com/250x150?text=No+Image';

                    // 建立簡單的 HTML 結構
                    const html = `
                        <div class="product-item">
                            <img src="${imgUrl}" class="product-img">
                            <h3>${item.name}</h3>
                            <p class="price">NT$ ${item.price}</p>
                            <p>${item.description}</p>
                            <div>
                                ${ (item.keywords || []).map(k => `<span class="tag">#${k}</span>`).join('') }
                            </div>
                        </div>
                    `;
                    
                    container.insertAdjacentHTML('beforeend', html);
                });

            } catch (error) {
                console.error("抓取失敗：", error);
                container.innerHTML = "無法載入資料，請檢查 Firebase 權限設定。";
            }
        }

        // 執行抓取
        fetchProducts();
    </script>
</body>
</html>